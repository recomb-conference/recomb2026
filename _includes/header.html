<!--
This header is customized for RECOMB.
It creates two navigation menus:
1. .desktop-nav: A horizontal menu with dropdowns for large screens.
2. .mobile-nav: A "hamburger" menu for small screens.
Both menus are populated from the `main_navigation` variable in _config.yml.
-->

{%- assign default_paths = site.pages | map: "path" -%}
{%- assign page_paths = site.header_pages | default: default_paths -%}

<header class="site-header">
  <div class="wrapper site-nav-wrapper">
    <a class="site-title" rel="author" href="{{ "/" | relative_url }}">
      {%- assign logo_default = "/images/recomb-logo/RECOMB2026_logo.svg" | relative_url -%}
      {%- assign logo_white = "/images/recomb-logo/RECOMB2026_logo_white.svg" | relative_url -%}
      {%- if page.layout == 'home' or page.layout == 'page' -%}
        {%- assign logo_path = logo_white -%}
      {%- else -%}
        {%- assign logo_path = logo_default -%}
      {%- endif -%}
      <img src="{{ logo_path }}" class="recomb-logo" alt="{{ site.title | escape }}" width=120px data-logo-default="{{ logo_default }}" data-logo-white="{{ logo_white }}">
    </a>

    <!-- 1. Desktop Navigation (Horizontal, with Dropdowns) -->
    <nav class="desktop-nav">
      <ul>
        {%- for item in site.main_navigation -%}
        <li class="nav-item-wrapper">
          {%- if item.children -%}
          <!-- This is a dropdown toggle -->
          <span class="page-link nav-dropdown-toggle">{{ item.title }}</span>
          <ul class="nav-dropdown-menu">
            {%- for child in item.children -%}
            <li>
              <a class="page-link" href="{{ child.url | relative_url }}" {%- if child.url contains 'http'
                -%}target="_blank" {%- endif -%}>
                {{ child.title }}
              </a>
            </li>
            {%- endfor -%}
          </ul>
          {%- else -%}
          <!-- This is a regular link -->
          <a class="page-link" href="{{ item.url | relative_url }}" {%- if item.url contains 'http' -%}target="_blank"
            {%- endif -%}>
            {{ item.title }}
          </a>
          {%- endif -%}
        </li>
        {%- endfor -%}
      </ul>
    </nav>

    <!-- 2. Mobile Navigation (Slide-in Panel from Left) -->
    <nav class="mobile-nav">
      <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Open navigation menu" aria-expanded="false">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path
              d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
          </svg>
        </span>
      </button>

      <!-- Overlay that appears when menu is open -->
      <div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>

      <!-- Slide-in panel -->
      <div class="mobile-nav-panel" id="mobile-nav-panel">
        <!-- Logo in the panel -->
        <div class="mobile-nav-logo">
          <img src="{{ '/images/recomb-logo/RECOMB2026_logo.svg' | relative_url }}" alt="{{ site.title | escape }}" width="120">
        </div>
        <ul>
          {%- assign accordion_index = 0 -%}
          {%- for item in site.main_navigation -%}
          <li class="nav-item-wrapper-mobile">
            {%- if item.children -%}
            {%- assign accordion_index = accordion_index | plus: 1 -%}
            <!-- Mobile: Accordion dropdown -->
            <input type="checkbox" id="accordion-{{ accordion_index }}" class="accordion-trigger" />
            <label for="accordion-{{ accordion_index }}" class="accordion-toggle">
              {{ item.title }}
              <span class="accordion-icon"></span>
            </label>
            <ul class="nav-dropdown-menu-mobile">
              {%- for child in item.children -%}
              <li>
                <a class="page-link" href="{{ child.url | relative_url }}" {%- if child.url contains 'http'
                  -%}target="_blank" {%- endif -%}>
                  {{ child.title }}
                </a>
              </li>
              {%- endfor -%}
            </ul>
            {%- else -%}
            <!-- Mobile: Regular link -->
            <a class="page-link" href="{{ item.url | relative_url }}" {%- if item.url contains 'http' -%}target="_blank"
              {%- endif -%}>
              {{ item.title }}
            </a>
            {%- endif -%}
          </li>
          {%- endfor -%}
        </ul>
      </div>
    </nav>
  </div>
</header>

<!-- Mobile Navigation JavaScript -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const overlay = document.getElementById('mobile-nav-overlay');
    const panel = document.getElementById('mobile-nav-panel');
    
    function openMenu() {
      panel.classList.add('is-open');
      overlay.classList.add('is-visible');
      document.body.classList.add('mobile-nav-open');
      menuToggle.setAttribute('aria-expanded', 'true');
    }
    
    function closeMenu() {
      panel.classList.remove('is-open');
      overlay.classList.remove('is-visible');
      document.body.classList.remove('mobile-nav-open');
      menuToggle.setAttribute('aria-expanded', 'false');
    }
    
    if (menuToggle) {
      menuToggle.addEventListener('click', openMenu);
    }
    
    if (overlay) {
      overlay.addEventListener('click', closeMenu);
    }
    
    // Close menu when clicking a link
    const navLinks = panel ? panel.querySelectorAll('a.page-link') : [];
    navLinks.forEach(function(link) {
      link.addEventListener('click', closeMenu);
    });
    
    // Close menu on window resize to desktop size
    window.addEventListener('resize', function() {
      if (window.innerWidth >= 800) {
        closeMenu();
      }
    });
  });
</script>
